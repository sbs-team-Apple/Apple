<!DOCTYPE html>
<html layout:decorate="~{common/layout}" lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<div layout:fragment="content" class="container my-3">
    <div class="ml-auto mr-auto w-60 ">
            <form  enctype="multipart/form-data" th:action="@{/board/create}"  object="${boardForm}" method="post" >

                <div class="current-img"></div>
                <div id="file-input-container">

        <!--            <input type="file" name="file" accept="image/*" class="image-file-input">-->

                    <button type="button" class="add-file-input">사진 추가</button>
                </div>
                <div class="pre-img">


                </div>


                <div>제목</div>
                <input type="text" name="subject">
                <div>내용</div>
                <input type="text" name="content">

                <button type="submit">작성 완료</button>



            </form>

    </div>




</div>
</body>
</html>

<style>
    .ex-current-img {
        width:300px;
        height:300px;

    }


   .ex-img {
        width:80px;
        height:80px;

    }
    .pre-img {
        position :absolute;
        top:50px;
        right:0;
    }

    .image-preview {
        position:relative;

    }

    .cancelBtn {
        position:absolute;
        top:0;
        right:0;
        background-color:red;
        width:20px;
        height:20px;


    }
</style>

<script>
    var currentIndex=1;
    var exImgs = $(".ex-img");
   $(document).ready(function() {

       var preImgContainer=$(".pre-img");
       var currentImg=$(".current-img");

     // "파일 추가" 버튼 클릭 이벤트
     $(".add-file-input").click(function() {
           $(".add-file-input").addClass("hidden");

         var fileInputContainer = $(this).prev(".image-file-input");
         var newFileInput = $("<input>", {
             type: "file",
             name: "file",
             accept: "image/**",
             class:  "image-file-input",
             currentIndex
         });
         var newImagePreview = $("<div>", { class: "image-preview" });

         newFileInput.change(function() {
             var file = newFileInput[0].files[0];

             if (file) {
                 var reader = new FileReader();

                 reader.onload = function(e) {
                     var previewImage = $("<img>", {
                       class:"ex-img" , onclick:"changeCurrentImg(this)"
                      }) ;
                     previewImage.attr("src", e.target.result);

                     var cancelBtn =$("<div>", {class:"cancelBtn",currentIndex   ,onclick:"hideImagePreview(this)"} );

                     currentIndex++;

                     var previewCurrentImage = $("<img>", {
                       class:"ex-current-img"
                      }) ;
                     previewCurrentImage.attr("src", e.target.result);
                     newImagePreview.empty().append(previewImage);
                     newImagePreview.append(cancelBtn);
                     currentImg.empty().append(previewCurrentImage);
                     exImgs = $(".ex-img");
                     console.log(exImgs);
                 };

                 reader.readAsDataURL(file);
                  $(" .image-file-input").addClass("hidden");
                     $(".add-file-input").removeClass("hidden");
             } else {
                 newImagePreview.empty();

             }
         });

         newFileInput.insertBefore($(this));
         preImgContainer.append(newImagePreview);


     });


 });

</script>

<script>


            function hideImagePreview(btn) {
                console.log(btn);
               var imagePreview = btn.closest('.image-preview');
                var exImg2 = imagePreview.find('.cancelBtn');
                console.log(exImg);
                let indexOfB = exImgs.indexOf(exImg);
               if (imagePreview) {

                      var btnCurrentIndex = $(btn).attr('currentIndex');

                    $('input[currentIndex="' + btnCurrentIndex + '"]').remove();

                       imagePreview.remove();
                       currentIndex--;
                        exImgs = $(".ex-img");
                        console.log(indexOfB);


                     }
                 }


</script>

<script>
    function changeCurrentImg(btn){
          var imgContent= $(btn).attr('src');


           $('.ex-current-img').attr('src',imgContent);



    }
</script>

<script>




</script>

